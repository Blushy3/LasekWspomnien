<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lasek Wspomnień</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        /* Stylizacja strony */
        @import url('https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap');

        /* Ukrycie pasków przewijania */
        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden;
        }

        body {
            font-family: 'Raleway', sans-serif;
            text-align: center;
            background: url('https://imgur.com/wc95oYL.png') no-repeat center center fixed;
            background-size: cover;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        main {
            overflow-y: scroll;
            -ms-overflow-style: none;
            scrollbar-width: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            padding: 20px 0;
        }

        main::-webkit-scrollbar {
            display: none;
        }

        @media (max-width: 767px) {
            main {
                overflow-y: auto;
            }
        }

        h1 {
            animation: fadeIn 3s ease-out, float 6s ease-in-out infinite;
            font-family: 'Raleway', sans-serif;
            margin-top: 50px;
            font-size: 3em;
            position: relative;
            z-index: 1;
        }

        .description {
            margin-top: 20px;
            font-size: 1.2em;
            text-align: center;
            animation: fadeInUp 2s ease-in-out;
            position: relative;
            z-index: 1;
        }

        .description p {
            font-size: 1em;
        }

        .button {
            margin-top: 50px;
            padding: 15px 30px;
            font-size: 18px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(135deg, #8a2be2, #4169e1, #ffffff);
            color: #ffffff;
            cursor: pointer;
            transition: background 0.3s, transform 0.3s;
            position: relative;
            z-index: 1;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .button:hover {
            background: linear-gradient(135deg, #4169e1, #8a2be2, #ffffff);
            transform: scale(1.1);
        }

        .search-container {
            position: relative;
            display: flex;
            align-items: center;
            width: 250px;
            margin-top: 20px;
        }

        .search-input {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.5);
            color: #000000;
            padding-left: 40px;
            border-radius: 10px;
            border: none;
            height: 40px;
            font-size: 16px;
            transition: color 0.3s;
        }

        .search-input:hover {
            background-color: rgba(200, 200, 200, 0.5);
            color: #1a1a1a;
        }

        .search-icon {
            position: absolute;
            left: 10px;
            font-size: 20px;
            color: #000000;
            pointer-events: none;
        }

        #gallery {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            position: relative;
            z-index: 1;
        }

        .gallery-item {
            display: inline-block;
            margin: 10px;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .gallery-item:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
        }

        .gallery-item img, .gallery-item video {
            width: 200px;
            height: auto;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .label-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 5px;
            box-sizing: border-box;
            pointer-events: none;
        }

        .format-label, .date-label {
            background-color: rgba(0, 0, 0, 0.5);
            color: #fff;
            padding: 2px 5px;
            border-radius: 5px;
            font-size: 12px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .small-print {
            font-size: 0.8em;
            margin-top: 20px;
            color: #cccccc;
            position: relative;
            z-index: 1;
            max-width: 80%;
            text-align: center;
        }

        .small-print p {
            margin: 5px 0;
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }

        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {
            0% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
            100% {
                transform: translateY(0);
            }
        }

        @keyframes zoomIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .menu {
            display: none;
            margin-top: 10px;
        }

        .video-container {
            display: none;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <main>
        <h1>Lasek Wspomnień</h1>
        <div class="description">
            <p>Miejsce, gdzie zapiszesz swoje wspomnienia na zawsze i nigdy nie znikną.</p>
        </div>
        <input type="file" id="file" name="file" style="display: none;" onchange="uploadFile()" />
        <button class="button" id="upload" onclick="showMenu()">Prześlij wspomnienie</button>
        <div class="menu" id="menu">
            <button class="button" onclick="showFileUpload()">Prześlij plik</button>
            <button class="button" onclick="showClipInput()">Udostępnij klip</button>
        </div>
        <div class="search-container">
            <span class="search-icon">&#128269;</span>
            <input type="text" class="search-input" id="searchInput" placeholder="Szukaj wspomnień..." oninput="filterGallery()" />
        </div>

        <div id="gallery"></div>

        <div class="small-print">
            <p>Strona nie pozwala na dodawanie zdjęć 18+ i NSFW. Każde zdjęcia tego typu będą usuwane ze strony po jakimś czasie. Prosimy o nie dodawanie takich zdjęć.</p>
            <p>Strona jest w fazie beta i nie wiadomo, czy będziemy dalej ją rozwijali.</p>
            <p>Wszystkie wasze zdjęcia są przechowywane w kodzie jak i w chmurze. Jeżeli coś zniknie ze strony, możemy to na spokojnie odzyskać.</p>
            <p>Prosimy, aby nie spamować przesyłaniem zdjęć. Wysyłajcie wspomnienia od czasu do czasu, aby uniknąć nałożenia ograniczenia na przesyłanie plików.</p>
            <p>Wyszukiwać można po formatach plików jak i datach.</p>
        </div>
        <div id="clipInputContainer" class="video-container">
            <input type="text" id="clipUrl" placeholder="Wklej link do klipu z Medal.tv">
            <button onclick="saveClip()">Zapisz klip</button>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let isOverlayActive = false;

            if (window.innerWidth >= 768) {
                document.addEventListener('mousemove', (e) => {
                    if (!isOverlayActive) {
                        const x = (e.clientX / window.innerWidth - 0.5) * 20;
                        const y = (e.clientY / window.innerHeight - 0.5) * 20;
                        document.body.style.transform = `translate(${x}px, ${y}px)`;
                    }
                });
            }

            async function uploadFile() {
                const file = document.getElementById('file').files[0];
                const formData = new FormData();
                formData.append('image', file);

                try {
                    console.log('Starting upload...');
                    const response = await fetch('https://api.imgur.com/3/image', {
                        method: 'POST',
                        headers: {
                            Authorization: 'Bearer YOUR_ACCESS_TOKEN',
                        },
                        body: formData,
                    });

                    if (!response.ok) throw new Error('Upload failed');
                    const result = await response.json();
                    const imageUrl = result.data.link;
                    const uploadDate = new Date().toISOString().split('T')[0];

                    alert('Wspomnienie zostało przesłane! URL wspomnienia: ' + imageUrl);
                    addMediaToGallery(imageUrl, uploadDate);
                    await saveImageUrl(imageUrl, uploadDate);
                } catch (error) {
                    console.error('Error:', error);
                }
            }

            function addMediaToGallery(url, date) {
                const gallery = document.getElementById('gallery');
                const mediaContainer = document.createElement('div');
                mediaContainer.classList.add('gallery-item');

                let mediaElement;
                let formatLabel;
                if (url.endsWith('.mp4')) {
                    mediaElement = document.createElement('video');
                    mediaElement.src = url;
                    mediaElement.controls = false;
                    mediaElement.setAttribute('controlsList', 'nodownload');
                    formatLabel = 'MP4';
                } else if (url.endsWith('.gif')) {
                    mediaElement = document.createElement('img');
                    mediaElement.src = url;
                    formatLabel = 'GIF';
                } else if (url.endsWith('.jpg') || url.endsWith('.jpeg')) {
                    mediaElement = document.createElement('img');
                    mediaElement.src = url;
                    formatLabel = 'JPG';
                } else if (url.endsWith('.png')) {
                    mediaElement = document.createElement('img');
                    mediaElement.src = url;
                    formatLabel = 'PNG';
                } else {
                    mediaElement = document.createElement('img');
                    mediaElement.src = url;
                    formatLabel = 'IMG';
                }

                const formatLabelElement = document.createElement('div');
                formatLabelElement.classList.add('format-label');
                formatLabelElement.textContent = formatLabel;

                const dateLabelElement = document.createElement('div');
                dateLabelElement.classList.add('date-label');
                dateLabelElement.textContent = date;

                const labelContainer = document.createElement('div');
                labelContainer.classList.add('label-container');
                labelContainer.appendChild(dateLabelElement);
                labelContainer.appendChild(formatLabelElement);

                mediaContainer.appendChild(mediaElement);
                mediaContainer.appendChild(labelContainer);
                gallery.insertBefore(mediaContainer, gallery.firstChild);

                mediaElement.onclick = () => enlargeMedia(mediaElement, formatLabel);
            }

            function enlargeMedia(mediaElement, formatLabel) {
                isOverlayActive = true;

                const overlay = document.createElement('div');
                overlay.style.position = 'fixed';
                overlay.style.top = '0';
                overlay.style.left = '0';
                overlay.style.width = '100%';
                overlay.style.height = '100%';
                overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
                overlay.style.display = 'flex';
                overlay.style.justifyContent = 'center';
                overlay.style.alignItems = 'center';
                overlay.style.zIndex = '1000';
                overlay.onclick = () => {
                    document.body.removeChild(overlay);
                    isOverlayActive = false;
                };

                const clonedElement = mediaElement.cloneNode(true);
                clonedElement.style.maxWidth = '90%';
                clonedElement.style.maxHeight = '90%';
                clonedElement.style.borderRadius = '10px';
                clonedElement.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
                clonedElement.style.transition = 'transform 0.3s';
                clonedElement.style.animation = 'zoomIn 0.5s ease';

                if (clonedElement.tagName === 'VIDEO') {
                    clonedElement.controls = true;
                    clonedElement.autoplay = true;
                }

                overlay.appendChild(clonedElement);
                document.body.appendChild(overlay);
            }

            async function saveImageUrl(url, date) {
                try {
                    const response = await fetch('https://api.github.com/repos/Blushy3/LasekWspomnien/contents/images.json');

                    if (!response.ok) {
                        console.error('Failed to fetch images.json:', response.status, response.statusText);
                        return;
                    }

                    const data = await response.json();
                    const content = atob(data.content.replace(/\s/g, ''));
                    const images = JSON.parse(content);

                    images.push({ url, date });
                    const updatedContent = btoa(JSON.stringify(images, null, 2));

                    const token = 'GQgVLLTIbH6TtxXoAfajR10OoVhLnM15OWMJ';
                    const updateResponse = await fetch('https://api.github.com/repos/Blushy3/LasekWspomnien/contents/images.json', {
                        method: 'PUT',
                        headers: {
                            'Authorization': 'Bearer ghp_' + token,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: 'Add new image URL',
                            content: updatedContent,
                            sha: data.sha,
                        })
                    });

                    if (!updateResponse.ok) {
                        console.error('Failed to update images.json:', updateResponse.status, response.statusText);
                    }
                } catch (error) {
                    console.error('Error saving image URL:', error);
                }
            }

            async function showGallery() {
                try {
                    const response = await fetch('https://api.github.com/repos/Blushy3/LasekWspomnien/contents/images.json');

                    if (response.ok) {
                        const data = await response.json();
                        const content = atob(data.content.replace(/\s/g, ''));
                        const images = JSON.parse(content);
                        const gallery = document.getElementById('gallery');
                        gallery.innerHTML = '';
                        images.forEach(({ url, date }) => {
                            addMediaToGallery(url, date);
                        });
                    } else {
                        console.error('Error fetching gallery images:', response.status, response.statusText);
                    }
                } catch (error) {
                    console.error('Error showing gallery:', error);
                }
            }

            function filterGallery() {
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                const galleryItems = document.querySelectorAll('.gallery-item');
                galleryItems.forEach(item => {
                    const formatLabel = item.querySelector('.format-label').textContent.toLowerCase();
                    const dateLabel = item.querySelector('.date-label').textContent;
                    const mediaElement = item.querySelector('img, video');
                    const mediaUrl = mediaElement.src.toLowerCase();

                    if (formatLabel.includes(searchTerm) || dateLabel.includes(searchTerm) || mediaUrl.includes(searchTerm)) {
                        item.style.display = 'inline-block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            }

            window.onload = function() {
                showGallery();
            }

            function showMenu() {
                document.getElementById('menu').style.display = 'block';
            }

            function showFileUpload() {
                document.getElementById('file').click();
            }

            function showClipInput() {
                document.getElementById('clipInputContainer').style.display = 'block';
            }

            function saveClip() {
                const clipUrl = document.getElementById('clipUrl').value;
                if (clipUrl) {
                    const clipData = {
                        date: new Date().toISOString(),
                        link: clipUrl
                    };

                    fetch('images.json')
                        .then(response => response.json())
                        .then(data => {
                            data.push(clipData);

                            fetch('images.json', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(data)
                            }).then(() => {
                                alert('Klip zapisany pomyślnie!');
                                document.getElementById('clipInputContainer').style.display = 'none';
                                document.getElementById('clipUrl').value = '';
                            }).catch(error => {
                                console.error('Error saving clip:', error);
                                alert('Błąd zapisu klipu.');
                            });
                        })
                        .catch(error => {
                            console.error('Error fetching existing data:', error);
                            alert('Błąd odczytu istniejących danych.');
                        });
                }
            }
        });
    </script>
</body>
</html>
